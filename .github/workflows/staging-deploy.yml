name: Deploy Altair and Staging
on:
  release:
    types:
      - prereleased
jobs:
  deploy_app:
    strategy:
      fail-fast: true
      matrix:
        deploy_to: ["altair", "staging"]
    uses: centrifuge/apps/.github/workflows/centrifuge-app.yml@gh-actions-refactor
    secrets: inherit
    with:
      deploy_env: ${{ matrix.deploy_to }}


  deploy_pinning:
    strategy:
      fail-fast: true
      matrix:
        deploy_to: ["altair", "staging"]
    uses: centrifuge/apps/.github/workflows/pinning-api.yml@gh-actions-refactor
    secrets: inherit
    with:
      deploy_env: ${{ matrix.deploy_to }}


  deploy_onboarding:
    strategy:
      fail-fast: true
      matrix:
        deploy_to: ["altair", "staging"]
    uses: centrifuge/apps/.github/workflows/onboarding-api.yml@gh-actions-refactor
    secrets: inherit
    with:
      deploy_env: ${{ matrix.deploy_to }}
    
    # - name: Notify prod deploy
    #   if: inputs.deploy_env == 'altair'
    #   uses: rtCamp/action-slack-notify@12e36fc18b0689399306c2e0b3e0f2978b7f1ee7
    #   env:
    #     SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
    #     SLACK_MESSAGE: "Main site deployed, go to ${{ needs.deploy.outputs.bucket_url  }} to check out what's new!"
    #     SLACK_USERNAME: "Centrifuge GHA Bot"
    #     SLACK_ICON: "https://centrifuge.io/favicon.ico"
    #     SLACK_TITLE: "Deployment using production credentials finished"
    #     SLACK_FOOTER: "Automatic message from centrifuge/website repository Actions"  
  