name: 'Prepare env strategy'
on:
  workflow_dispatch:
    inputs:
      deploy_prod:
        type: boolean
        default: false

jobs:
  determine_gitref:
    runs-on: ubuntu-latest
    outputs:
      gitref: ${{ steps.getref.outputs.gitref }}
    steps:
      - name: determine branch for prod deploys
        id: getref
        working-directory: './'
        shell: bash
        run: |
          # defaults to trigger origin:
          echo "gitref=${{ github.ref }}" >> $GITHUB_OUTPUT
          if  ${{ inputs.deploy_prod }}; then 
            if ${{ startsWith(inputs.release_tag, 'release') }}; then
              # Override checkout with input tag for prod:
              echo "gitref=refs/tags/${{inputs.release_tag}}" >> $GITHUB_OUTPUT
            else
              echo "::error title=bad_tag::Selected production deploy but no release tag. Aborting..."
            fi
          fi