name: Generic yarn build process
description: 'Determine functions name, URL and GHA environment secrets'

inputs:
  artifact_name:
    description: "function name"
    required: true

runs:
  using: composite
  steps:
    - name: Setup Node
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: yarn

    - name: Install Dependencies
      working-directory: ${{ inputs.artifact_name }}
      shell: sh
      # env:
      #   NODE_ENV: production
      run: yarn install --immutable

    - name: Lint
      working-directory: ${{ inputs.artifact_name }}
      shell: sh
      run: yarn lint

    - name: Build ${{ inputs.artifact_name }}
      working-directory: ${{ inputs.artifact_name }}
      shell: sh
      # env:
      #   NODE_ENV: production      
      # run: ${{ inputs.build_cmd }}
      run: yarn build
    
    - uses: actions/upload-artifact@v3
      with: 
        name: ${{ inputs.artifact_name }}
        path: ./${{ inputs.artifact_name }}/dist
        if-no-files-found: error  
        
    - shell: bash
      id: debug1
      run: | 
        echo "${{inputs.artifact_name}}"
        echo "${{ contains(inputs.artifact_name, 'staging')}}"

    - name: Archive staging artifacts
      id: archive_staging
      if: contains(inputs.artifact_name, 'staging')
      uses: ./.github/actions/archive-release
      with:
        name: ${{ inputs.artifact_name }}
        path: ./${{ inputs.artifact_name }}/dist